# Network layer

1. LAN или локальная сеть позволяет передавать данные между узлами в рамках сети одного типа, на коротких дистанциях. Работа производится на свитчах которые знают мак адреса устройства и контролируют передачу пакетов, разгружая сеть от шума и коллизий. Если сеть небольшая то свитчи справляются. Более того мак адреса имеют случайный набор значений и если ноды будут расположены оооочень далеко (или оочень много), то поиск нужного устройства будет долгим и непонятным. Эту проблему решает **сетевой уровень**, а точнее протокол IP и IP адресса.
2. IP представлен в точечно-десятичном формате. Маки определяют производители (поэтому по \*\* можно понять производителя), а IP определяют компании. Отсюда вывод - IP адреса относятся к сетям, а не устройствам в сетях.
3. Как на уровне ниже данные передаются биты, кадры. Так на этом уровне пейлоад теперь называется IP datagram
4. Датаграмма это такая структура, которая хранит всю необходимую информацию для сетей.

- 4 бита - версия (ip4v например)
- есть 4 бита для сервисов - они дают понимания роутерам какая диаграма приоритетней и важней.
- поле идентификации - понимает связь между пакетами если они являются одним единым блоком информации. В общем про этот блок нужно почитать еще Identification
- Датаграммы могут быть дефрагментированны. За эту инфу отвечают флаг смещения и поле фрагментации датаграммы.
- TTL флаг (время жизни) он уменьшается роутерами каждый раз когда попадает в один и тот же роутер, чтобы передача датаграммы не была бесконечной.
- Поле протокола. TCP или UPD
- Header checksum меняется каждый раз потому что меняется TTL. А смысл его такой же как у кадров. Получивший нод проверит что диаграмма дошла без изменений путем подсчета всех полей и сравнению хеша.
- IP адреса источника и назначения

Как я понял сети разные могут по разному понимать датаграммы и поэтому если понимают большие датаграммы, то отправленная датаграмма может в нее вместиться. Если нет - она дефрагментируется.

## IP адреса

IP адреса делятся на две части,

- первые **XXX**.XXX.XXX.XXX. это network ID,
- второе XXX.**XXX.XXX.XXX** это host id.
  Так же ip адреса делятся на три класса
- class a - первый октет используется для network Id, а последние для host id - **XXX**.XXX.XXX.XXX
- class b - первые два октета для network id, остальные для хоста - **XXX.XXX**.XXX.XXX
- class c - первые три октета для network id, последний для хоста - **XXX.XXX.XXX**.XXX

Adress resolution protocol - протокол который связывает MAC адреса с IP адресами. Т.е. это набор правил как найти нод с Маком по конкретному IP.
Как только датаграмма сформирована, она кладется в кадр как пейлоад. А значит устройство которое будет перенаправлять фрейм, должен знать MAC адрес назначения и он должен быть вложен в заголовок фрейма.
У всех устройств передающих фреймы, есть таблицы ARP которые содержат мак адреса и соответствующие IP.

Когда машина впервые выходит на связь, нигде естественно не упоминаются ее мак адреса и IP. И при первом взаимодействии, сетевая карта отправляет всем устройствам широковещательное ARP сообщение с ответом. Так заполняется таблица ARP благодря которой уже не надо делать эти широковещательные запросы опять. ARP таблицы не постоянны, у них есть срок очитски.
